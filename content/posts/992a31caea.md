---
title: "Rust 与 RIIR"
date: "2025-03-22T09:27:35+08:00"
tags: ["后端开发", "随笔"]
draft: false
noindex: false
enableKaTeX: false
cover:
    image: "/img/992a31caea.md/cover.png"
    alt: "多彩的初音未来"
    hidden: false
---

> 词元是 Rust 初学者，本文一些观点可能从 C++ 和 Python 开发者的角度出发，可能不符合 Rust 的实际理念；如果出现，请不吝在评论中指出，谢谢 🙏

![Rust 的官网](/img/992a31caea.md/1.png)

[Rust](https://www.rust-lang.org) 是一门很有意思的语言。单单从官网的设计，词元至少可以提取出几个特点：

- ~~Mozilla 赞助的~~（这个字体真的是太明显了 😁）。
- 偏向底层的语言（字体和图标设计）。
- 现代化的设计理念（与 C++ 相关网站的设计相比：[cplusplus.com](https://cplusplus.com/)、[cppreference.com](https://en.cppreference.com/w/)）。
- 统一的实现、比较完善的文档（直接给出了下载链接；试想如果 C++ 标准给出了推荐编译器……）。

这则博客，词元就想随便聊聊最近学习 Rust 和关于 Rust 的应用的一些想法。

## 🫤 Rust 的特点

Rust 的出现和流行，很大程度上是因为**用现代的设计实现了底层的功能**。

用现代的设计，是说它借鉴了新的程序设计概念，例如 [crates.io](https://crates.io) 与 PyPI 和 NPM 理念很相似，内置项目管理（Cargo）和格式化（rustfmt）工具，还有原生的 LSP 功能。

实现了底层的功能，是说它仍然是一个低依赖、高效率、允许底层操作的语言。它用自己的**所有权**概念代替了实现内存安全的常见方法——垃圾回收，用编译期检查代替运行时。这使得 Rust 具有与 C 和 C++ 接近的效率和更安全的内存操作。

ACK，从 Rust 书上抄过来的定义完毕，接下来说说我的想法。

- Rust 对于 Python 和 JS 程序员的吸引远远超过 C 和 C++ 程序员。
  > 因为虽然 Rust 学习成本高于前者，但是学会之后，就可以继续不必担心内存问题；而对于后者，手动操作内存和细致的编程习惯已经成为常态，Rust 严格的控制反而会让他们不舒服。
  > 
  > 对于词元自己，词元偏向后端，C 用得多，Rust 最初确实让我不太适应，但是毕竟不像那些大佬，C 的习惯刻进 DNA，词元还是勉强可以适应的。
- Rust 对于 OIer 的吸引力很大。
  > 很简单，妈妈再也不用担心 RE 啦 😁
- Rust 的语法很冗长且丑陋，虽然这并不会导致词元讨厌它。
  > 这种感觉的原因，大概是“久居 C 语言，不闻其不合理”，习惯而已。`mut` 这个其他语言通常写作 `var` 的遍地都有的关键字真的很难受，还有一些习惯性的写法如 `a = b = 1` 是无效的。
  > > 最后一个例子无效，是因为 `b = 1` 是 statement 而非 expression，没有返回值。

## 🏛️ 学习 Rust

虽然 Rust 在国内还没有成规模，找不到什么比较好的中文资料；但是但凡懂点英文，Rust 一大优势——文档，就很明显了。这么说吧，Rust 不仅仅有广受好评的入门资料 [the Book](https://doc.rust-lang.org/book/)，而且包括标准库在内的所有文档都可以在编译器中看离线版，还有大部分编译错误的详细解释。

词元的英语还不错，所以学习起来没有太多障碍。前面提过，Rust 的语法比较冗长，因此记忆上可能需要一些练习，才能牢固。例如，要想把所有 Rust 要求的安全措施做全（至少得不报警告吧），写一个简单的输入要这样：

```rust
use std::io;
let mut some_value = String::new();
io::stdin()
    .read_line(&mut some_value)
    .expect("Failed to read line");
```

然后，理解所有权的概念不难，但是在真正写代码的时候记得要求却很麻烦。例如，这么赋值，两个变量都是可用的：

```rust
let mut a = 1;
let mut b = a;
```

但是，对字符串做同样的事就会导致 `a` 不可用。

```rust
let mut a = String::from("hello");
let mut b = a;
```

至于为什么，您可能得自己去看看 the Book，才能搞清楚；搞清楚了还不行，得记住哪些是栈上的类型，哪些是堆上的。

词元目前还在努力学习，有些更特殊、困难的用法，未来学到了再和大家聊聊吧。

## 🤬 RIIR

即 [**r**ewrite **i**t **i**n **R**ust](https://github.com/ansuz/RIIR)，拿 Rust 重构。

这个梗其实是几年之前比较流行的了，当时有很多人在各种开源项目的仓库，请求把这些项目用 Rust 重写，实现更好的安全性，其中包括 Tor、Linux 内核、NixOS，当然还有整活的地球、DNA、铁、TypeScript、C++（？！）。

> 其中最后两个有原型：TypeScript 确实在用 Go 重写；有一个 [Safe C++](https://safecpp.org/draft.html) 在给 C++ 添加类似于 Rust 的内存安全功能。

词元突然发现这件事，其实是因为前两天发现 Fish Shell 修改了默认颜色方案，然后去看 GitHub 仓库，然后发现发布了 4.0.0 大版本更新，然后发现大版本更新的原因是它[真的被 RIIR 了](https://fishshell.com/docs/current/relnotes.html#fish-4-0-0-released-february-27-2025)……

~~虽然这是件好事。~~

按照词元的看法，用 Rust 重写一些应用是好事，毕竟低质量、小规模的 C 项目，用 Rust 重写确实会产生一些正面影响。但是，也没必要到处去要求开发者重写：按照一些项目维护者的说法，“你怎么不写啊？”

尤其是 Tor 甚至 Linux 内核这类的大项目，很难重写，后者重度依赖 C 提供的灵活内存访问。虽然 Linux 内核确实在加入 Rust 代码，但是多是外围项目，真正的内核一定是纯 C 语言的。

Rust 确实给我们带来了无限遐想（或者瞎想），曾经被看作无法解决的问题，例如网页服务器性能和网络功能的冲突，Rust 确实能很好地解决。在国内，Rust 岗位似乎不是很多，但是也可以看到大厂开始用 Rust 改写 Java 的烂摊子。

~~也许等到词元大学毕业，Rust 就会迎来几年前 Python 一样的热潮呢？这笔投资太值得了。~~

## 🎇 下课！

电脑上很多东西都生锈了呢。（Firefox、Fish Shell、Linux 内核……）
